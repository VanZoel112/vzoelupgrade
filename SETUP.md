# VBot Setup Guide

## Prerequisites

1. Bot token from @BotFather
2. API credentials from https://my.telegram.org
3. Owner/Developer Telegram User ID
4. **Assistant account** - separate phone number for voice chat streaming

## Configuration Steps

### Step 1: Environment Configuration

Edit `.env` file and fill in these required values:

```env
# Bot Configuration
BOT_TOKEN="your_bot_token_here"
API_ID=your_api_id
API_HASH="your_api_hash_here"

# User Authorization
OWNER_ID=your_telegram_user_id
DEVELOPER_IDS=your_telegram_user_id
```

### Step 2: Assistant Account Setup (REQUIRED for Voice Chat)

VBot music system is **hybrid** - it requires:
- **Bot account** - handles commands and messages
- **User account (Assistant)** - joins voice chats and streams audio/video

#### Why Assistant Account is Needed:

- Telegram bots CANNOT join voice chats directly
- User account joins VC and streams media
- This account will be visible in voice chats
- Required for `/play` (audio) and `/vplay` (video) commands

#### Generate Assistant Session:

Run the session generator script:

```bash
python genstring.py
```

This will:
1. Ask for API credentials (same API_ID and API_HASH from .env)
2. Ask for phone number (MUST be different from owner's number)
3. Send OTP code to that phone
4. Ask for OTP verification
5. Ask for 2FA password (if enabled)
6. **Automatically save STRING_SESSION to .env**
7. Create backup file `string_session.txt`

**IMPORTANT:**
- Use a DIFFERENT phone number from bot owner
- This account will appear in voice chats when streaming
- Keep STRING_SESSION secret (full account access)
- Run this ONCE during initial setup

### Step 3: YouTube Cookies (Optional but Recommended)

YouTube may block bot requests. Cookies help bypass this.

#### Option A: Browser Cookies (Development)

```env
YOUTUBE_COOKIES_FROM_BROWSER="chrome"
```

Supported browsers: chrome, firefox, edge, opera, brave

#### Option B: Cookies File (Production)

1. Install browser extension: "Get cookies.txt" or "cookies.txt"
2. Export YouTube cookies to `youtube_cookies.txt`
3. Place file in project root
4. Set in .env:

```env
YOUTUBE_COOKIES_FILE="youtube_cookies.txt"
```

### Step 4: Verify Configuration

Check `.env` file has:

```env
BOT_TOKEN="..."
API_ID=...
API_HASH="..."
OWNER_ID=...
STRING_SESSION="..."  # Generated by genstring.py
YOUTUBE_COOKIES_FILE="youtube_cookies.txt"  # Optional
```

### Step 5: Start Bot

```bash
python main.py
```

On startup, you should see:

```
✅ Configuration validated successfully!
Initializing assistant client for voice chat streaming...
✅ Assistant client initialized successfully
✅ Bot started successfully!
```

## Troubleshooting

### Music Commands Not Working

**Symptom:** `/play` and `/vplay` commands fail or do nothing

**Solution:**

1. Check STRING_SESSION is set in `.env`:
   ```bash
   grep STRING_SESSION .env
   ```
   Should show: `STRING_SESSION="AgE...long_string..."`

2. If empty, run:
   ```bash
   python genstring.py
   ```

3. Restart bot:
   ```bash
   python main.py
   ```

### Assistant Client Initialization Failed

**Symptom:** Error during bot startup about assistant client

**Possible causes:**
- STRING_SESSION is invalid or expired
- API_ID/API_HASH mismatch
- Assistant account was deleted/banned

**Solution:**
- Regenerate session: `python genstring.py`
- Use same API_ID and API_HASH as in .env
- Use active, unbanned Telegram account

### YouTube Download Fails

**Symptom:** "Failed to download" errors for YouTube links

**Solution:**

1. Add YouTube cookies:
   - Development: Set `YOUTUBE_COOKIES_FROM_BROWSER="chrome"`
   - Production: Export cookies to `youtube_cookies.txt`

2. Update yt-dlp:
   ```bash
   pip install -U yt-dlp
   ```

## Features

### Voice Chat Streaming
- `/play <query>` - Stream audio in voice chat
- `/vplay <query>` - Stream video in voice chat
- `/pause` - Pause playback
- `/resume` - Resume playback
- `/skip` - Skip to next song
- `/stop` - Stop and clear queue
- `/queue` - Show current queue

### Tag System
- `/tagall [message]` - Tag all members progressively
- `/cancel` - Cancel ongoing tag process

### Lock System
- `/lock <user>` - Lock user (auto-delete messages)
- `/unlock <user>` - Unlock user
- `/locklist` - Show locked users

### Admin Management
- `/pm <user> [title]` - Promote to admin
- `/dm <user>` - Demote from admin

## System Architecture

```
VBot (Hybrid Architecture)
├── Bot Account
│   ├── Handles all commands
│   ├── Processes messages
│   └── Manages chat operations
│
└── Assistant Account (User)
    ├── Joins voice chats
    ├── Streams audio/video
    └── Handles PyTgCalls operations
```

## Security Notes

- **STRING_SESSION** = Full account access to assistant account
- Keep `.env` file SECRET
- Don't commit `.env` or `youtube_cookies.txt` to git
- Assistant account should be dedicated for bot use only
- Use strong 2FA on assistant account

## Support

For issues:
1. Check logs in console
2. Verify configuration in `.env`
3. Review this setup guide
4. Check if all dependencies are installed: `pip install -r requirements.txt`
